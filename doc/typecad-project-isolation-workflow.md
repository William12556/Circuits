# TypeCAD Project Isolation Workflow

Created: 2025 January 23

## Table of Contents

- [Overview](#overview)
- [Directory Structure](#directory-structure)
- [Restructuring Existing Projects](#restructuring-existing-projects)
- [Creating New Projects](#creating-new-projects)
- [Build Process](#build-process)
- [Diagram Output](#diagram-output)
- [Version History](#version-history)

## Overview

This workflow ensures each typeCAD project maintains isolated output directories while sharing common resources (footprints, symbols, 3D models). Generated files remain project-specific, preventing output mixing.

**Key Principle**: Reverse symlink approach - shared resources link INTO project directories, not vice versa.

## Directory Structure

```
Circuits/
├── build/                          # Shared resources only
│   ├── footprints/                 # Flattened KiCAD footprints
│   └── lib/                        # Symbols and 3D models
│
├── led-test-circuit/               # Example project
│   ├── src/
│   │   └── index.ts
│   ├── build/                      # Real directory (isolated)
│   │   ├── footprints -> ../build/footprints  # Symlink IN
│   │   ├── lib -> ../build/lib                # Symlink IN
│   │   ├── diagrams/                          # Project-specific
│   │   ├── led-test.kicad_pcb                 # Project-specific
│   │   └── led-test.net                       # Project-specific
│   └── package.json
│
└── init-typecad-project.sh         # Project template script
```

**Rationale**: TypeCAD reads from `build/footprints/` and `build/lib/` (symlinked to shared resources) but writes all outputs to the real `build/` directory within each project.

[Return to Table of Contents](#table-of-contents)

## Restructuring Existing Projects

For projects using old symlink structure (`project/build -> ../build`):

```bash
cd ~/Documents/GitHub/Circuits/led-test-circuit
chmod +x restructure-build.sh
./restructure-build.sh
```

**What it does**:
1. Removes existing `build` symlink
2. Creates real `build/` directory with `diagrams/` subdirectory
3. Creates selective symlinks: `build/footprints` and `build/lib` pointing to shared resources
4. Verifies structure

**One-time operation per project**. After restructuring, all builds output to project-specific locations.

[Return to Table of Contents](#table-of-contents)

## Creating New Projects

Use the initialization template:

```bash
cd ~/Documents/GitHub/Circuits
chmod +x init-typecad-project.sh
./init-typecad-project.sh my-new-project

cd my-new-project
npm install
npm run build
```

**Template creates**:
- Isolated `build/` directory with `diagrams/` subdirectory
- Selective symlinks to shared resources
- Basic `package.json` with typeCAD dependencies
- TypeScript configuration
- Starter `src/index.ts`

[Return to Table of Contents](#table-of-contents)

## Build Process

Standard typeCAD workflow remains unchanged:

```typescript
import { PCB } from '@typecad/typecad';

let typecad = new PCB('my-circuit');

// Add components and connections

typecad.create();  // Outputs to ./build/
```

**Default behavior**: TypeCAD automatically writes to `./build/` within the project directory, which is now isolated.

[Return to Table of Contents](#table-of-contents)

## Diagram Output

Diagrams generated by typeCAD or external tools should be placed in `build/diagrams/`:

```typescript
// Example: Configure diagram output
typecad.option.diagram_dir = './build/diagrams/';
```

**Organization**: Each project's diagrams remain within its own `build/diagrams/` directory, preventing cross-project contamination.

[Return to Table of Contents](#table-of-contents)

## Version History

| Version | Date       | Changes                                    |
|---------|------------|--------------------------------------------|
| 1.0.0   | 2025-01-23 | Initial workflow documentation             |
|         |            | Created restructure and initialization scripts |
|         |            | Established reverse symlink methodology    |

---

Copyright (c) 2025 William Watson. This work is licensed under the MIT License.
